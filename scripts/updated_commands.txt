
sudo apt update
sudo apt install build-essential lzop u-boot-tools net-tools bison flex libssl-dev libncurses5-dev libncursesw5-dev unzip chrpath xz-utils minicom wget git-core

// replace the compiler download with installing the one from debian (this ends up using gcc13, much newer than the gcc7.5 in the class)
sudo apt install gcc-arm-linux-gnueabihf


STEP 0
git clone https://github.com/beagleboard/linux.git sources/linux_bbb
// from the linux_bbb folder
// I'm using the latest (2025) BBB drop that has debian 12.11 and uses 6.12 kernel, I use this instead of the 5.x kernel.
git switch v6.12.24-ti-arm64-r41
make ARCH=arm distclean​
make ARCH=arm omap2plus_defconfig​

// I did not run/verify this one
make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- menuconfig​

​make -j 8 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- LOADADDR=0x80008000​ uImage dtbs
make -j 8 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- modules
sudo make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- modules_install

// attaching SD card directly to VirtualBox
// copying new kernel to SD card BOOT partition, from linux_bbb folder
mv /media/sharif/BOOT/uImage /media/sharif/BOOT/uImage_4.4.62
mv /media/sharif/BOOT/am335x-boneblack.dtb /media/sharif/BOOT/am335x-boneblack_old.dtb

cp arch/arm/boot/uImage /media/sharif/BOOT/
cp arch/arm/boot/dts/ti/omap/am335x-boneblack.dtb /media/sharif/BOOT/
sync

// copy kernel modules to ROOTFS partition
sudo cp -a /lib/modules/6.12.24-g33d950e8d86d/ /media/sharif/ROOTFS/lib/modules/
sync

// did not mess with internet tethering... plugged beagleboard into home router via ethernet

// building loadable module for host, from the /custom_drivers/001hello_world/ folder
make host
sudo insmod main.ko
sudo dmesg
sudo rmmod main.ko
sudo dmesg

// comment out the KERN_DIR definition in the existing Makefile, then
make KERN_DIR=../../sources/linux_bbb/ clean

// building loadable module for target, from the /custom_drivers/001hello_world/ folder
make KERN_DIR=../../sources/linux_bbb/
file main.ko
modinfo main.ko

// copying to BBB, attach to BBB usb to VirtualBox, check that ubuntu sees both 6.2 and 7.2 ip addresses.
// on target
mkdir drivers
// on host
scp main.ko debian@192.168.7.2:/home/debian/drivers/
// back on target
sudo insmod drivers/main.ko
sudo rmmod main.ko
